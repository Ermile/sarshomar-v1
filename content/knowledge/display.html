{%extends display.main%}

{%block content%}
{%for key, value in list%}
<a href="{{base.url}}/{{value.post_url}}" style="cursor:pointer" data-direct>{{value.post_title}}</a>
<br>
{%endfor%}

<div class="row question-box">
    <div class="container">
        <article class="row auto">
            <section class="span8">
                <h2>{{ post.post_title }}</h2>

                <nav class="social">
                    <a href="#"><i class="fa fa-paper-plane" aria-hidden="true"></i></a>
                    <a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a>
                    <a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a>
                    <a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a>
                    <a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
                    <a href="#"><i class="fa fa-wordpress" aria-hidden="true"></i></a>
                    <a href="#"><i class="fa fa-rss" aria-hidden="true"></i></a>
                </nav>
                    <div class="opt">
                        {%for key, value in post.post_meta.opt%}
                            <li>
                                <a class="answer-link" data-id="{{post.id}}" data-key="{{value.key}}" data-text="{{value.txt}}" style="cursor:pointer">{{value.txt}}</a>
                            </li>
                        {%endfor%}

                    </div>
                    <h5 class="next-url">
                        {% if next_url %}
                            <a href="{{base.url}}/{{next_url}}" data-direct>سوال بعدی</a>
                        {% endif %}
                    </h5>
                     <h5 class="next-url">
                        {% if previous_url %}
                            <a href="{{base.url}}/{{previous_url}}" data-direct>قبلی بعدی</a>
                        {% endif %}
                    </h5>

                <div class="description">
                	{% if post.post_language == "en" %}
                		<p>{{ post.post_content }}</p>
                	{% else %}
                    	<p>ورزش یه نوعی تحرک ارادی است که باید آن را انجام داد بنابراین من همیشه باید ورزش کنم وگرنه مریض می شوم و می میرم</p>
                    	<p>پس از همه شما دوستان عزیز دعوت به ورزش می کنم تا فلج نشوید و بیوفتید و بمیرید</p>
                    	<p>والسلام ختم کلام</p>
                	{% endif %}
                </div>
                {%if article%}
                    <div class="read-more">
                        <label>در همین رابطه بخوانید</label>
                        <a href="{{article[0].url}}">
                            <span data-hover="{{article[0].title}}">{{article[0].title}}</span>
                        </a>
                    </div>
                {%endif%}
            </section>
            {%if similar%}
            <nav class="span4 related-questions">
                <h3>سوالات مشابه</h3>
                {%for key, value in similar%}
                    <a href="{{base.url}}/{{value.url}}">{{value.title}}</a>
                {%endfor%}
            </nav>
            {%endif%}
        </article>
    </div>
</div>
{%if chart%}
<div class="row results-box">
    <section class="row results">
        <nav class="tabs">
            {%for key, value in chart%}

                {%if value.categories != 'null'%}
                    <a href="#" chart-type="{{key}}" class="chart-{{key}} {% if key == 'result' %}active{%endif%}">{{key|trans}}</a>
                {%endif%}
            {%endfor%}
        </nav>
    </section>
    <div class="container poll-chart chart"></div>
</div>
{%endif%}
<div class="row comments">
    <div class="container">
        <h4>نظرات و امتیازات</h4>
        <div class="row auto">
            <div class="span4 summary">
                <div class="average-score">
                    {% if site.currentlang == "fa" %}
                        {{ 4.6|persian }}
                    {% else %}
                        4.6
                    {% endif %}
                </div>
                <div class="row">
                    <span><i class="fa fa-2x fa-star" aria-hidden="true"></i></span>
                    <span><i class="fa fa-2x fa-star" aria-hidden="true"></i></span>
                    <span><i class="fa fa-2x fa-star" aria-hidden="true"></i></span>
                    <span><i class="fa fa-2x fa-star" aria-hidden="true"></i></span>
                    <span><i class="fa fa-2x fa-star" aria-hidden="true"></i></span>
                    <span class="stars-number">
                        {% if site.currentlang == "fa" %}
                            {{ 108|persian }}
                        {% else %}
                            108
                        {% endif %}
                    </span>
                </div>
                <div class="bars">
                    <div class="bar-one"></div>
                    <div class="bar-two"></div>
                    <div class="bar-three"></div>
                    <div class="bar-four"></div>
                    <div class="bar-five"></div>
                </div>
            </div>

            <div class="span4 comment">
                <div class="score">
                    <div class="plus" data-value="23">
                        <object data="/static/images/score-g.svg">
                            <span>hello</span>
                        </object>
                    </div>
                    <div class="minus">
                        <object data="/static/images/score-r.svg" data-value="12"></object>
                    </div>
                </div>
                <div class="title">بهتر شود</div>
                <div>
                    <span><i class="fa fa-star" aria-hidden="true"></i></span>
                    <span><i class="fa fa-star" aria-hidden="true"></i></span>
                    <span><i class="fa fa-star" aria-hidden="true"></i></span>
                    <span><i class="fa fa-star" aria-hidden="true"></i></span>
                    <span><i class="fa fa-star" aria-hidden="true"></i></span>
                </div>
                <div class="user">هشمت</div>
                <div class="content">
                    <p>در مورد شدت بیماری خانم کلینتون دقیقا چیزی نمی‌دانیم اما به نظر می‌رسد که او در خانه‌اش تحت درمان قرار دارد نه در بیمارستان، بنابراین در بهترین حالت می‌توان گفت سریع‌ترین زمان ممکن برای بهبود سه روز و تا بازیابی کامل قوا حدود یک هفته خواهد بود. اما سوالی که مطرح است این است که اگر خانم کلینتون نتواند به دلیل بیماری، رقابت‌های انتخاباتی را ادامه دهد چه خواهد شد؟</p>
                </div>
                <span class="continue">ادامه</span>
            </div>

            <div class="span4 comment">
                <div class="score">
                    <div class="plus" data-value="23">
                        <object data="/static/images/score-g.svg">
                            <span>hello</span>
                        </object>
                    </div>
                    <div class="minus">
                        <object data="/static/images/score-r.svg" data-value="12"></object>
                    </div>
                </div>
                <div class="title">بهتر شود</div>
                <div>
                    <span><i class="fa fa-star" aria-hidden="true"></i></span>
                    <span><i class="fa fa-star" aria-hidden="true"></i></span>
                    <span><i class="fa fa-star" aria-hidden="true"></i></span>
                    <span><i class="fa fa-star" aria-hidden="true"></i></span>
                    <span><i class="fa fa-star" aria-hidden="true"></i></span>
                </div>
                <div class="user">هشمت</div>
                <div class="content">
                    <p>در مورد شدت بیماری خانم کلینتون دقیقا چیزی نمی‌دانیم اما به نظر می‌رسد که او در خانه‌اش تحت درمان قرار دارد نه در بیمارستان، بنابراین در بهترین حالت می‌توان گفت سریع‌ترین زمان ممکن برای بهبود سه روز و تا بازیابی کامل قوا حدود یک هفته خواهد بود. اما سوالی که مطرح است این است که اگر خانم کلینتون نتواند به دلیل بیماری، رقابت‌های انتخاباتی را ادامه دهد چه خواهد شد؟</p>
                </div>
                <span class="continue">ادامه</span>
            </div>
        </div>

        <div class="row auto">
            {% for i in 0..2 %}
                <div class="span4 comment">
                    <div class="score">
                        <div class="plus" data-value="23">
                            <object data="/static/images/score-g.svg">
                                <span>hello</span>
                            </object>
                        </div>
                        <div class="minus">
                            <object data="/static/images/score-r.svg" data-value="12"></object>
                        </div>
                    </div>
                    <div class="title">بهتر شود</div>
                    <div>
                        <span><i class="fa fa-star" aria-hidden="true"></i></span>
                        <span><i class="fa fa-star" aria-hidden="true"></i></span>
                        <span><i class="fa fa-star" aria-hidden="true"></i></span>
                        <span><i class="fa fa-star" aria-hidden="true"></i></span>
                        <span><i class="fa fa-star" aria-hidden="true"></i></span>
                    </div>
                    <div class="user">هشمت</div>
                    <div class="content">
                        <p>در مورد شدت بیماری خانم کلینتون دقیقا چیزی نمی‌دانیم اما به نظر می‌رسد که او در خانه‌اش تحت درمان قرار دارد نه در بیمارستان، بنابراین در بهترین حالت می‌توان گفت سریع‌ترین زمان ممکن برای بهبود سه روز و تا بازیابی کامل قوا حدود یک هفته خواهد بود. اما سوالی که مطرح است این است که اگر خانم کلینتون نتواند به دلیل بیماری، رقابت‌های انتخاباتی را ادامه دهد چه خواهد شد؟</p>
                    </div>
                    <span class="continue">ادامه</span>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<div class="row details">
    <div class="container">
        <div class="row auto">
            <h5>توضیحات</h5>
            <div class="span6">
                <div class="title">بازه سوال</div>
                <div class="detail"><span class="green">۱۲ فروردین ۱۳۹۵</span> تا <span class="red">۲۰ فروردین 1395</span></div>
                <div class="title">وضعیت نظرسنجی</div>
                <div class="detail"><span class="green">در حال انجام است</span></div>
                <div class="title">کلیدواژه ها</div>
                <div class="detail tags">
                  {% for tag in post.tags %}
                    <a href="#">{{tag}}</a>
                  {% endfor %}
                </div>
            </div>

            <div class="span6 border">
                <div class="title">جامعه آماری هدف:</div>
                <div class="row auto">
                    <div class="span4">
                        <div class="detail">
                            <span><i class="fa fa-2x fa-venus-mars" aria-hidden="true"></i></span>خانم ها
                        </div>
                        <div class="detail"><span><i class="fa fa-2x fa-circle-o-notch" aria-hidden="true"></i></span>+20 تا 40</div>
                        <div class="detail"><span><i class="fa fa-2x fa-users" aria-hidden="true"></i></span>مجرد</div>
                        <div class="detail"><span><i class="fa fa-2x fa-rocket" aria-hidden="true"></i></span>در حال تحصیل</div>
                    </div>
                    <div class="span8">
                        <div class="detail"><span><i class="fa fa-2x fa-certificate" aria-hidden="true"></i></span>کاردانی / کارشناسی ارشد / دکتری</div>
                        <div class="detail"><span><i class="fa fa-2x fa-map-marker" aria-hidden="true"></i></span>کرج / تهران / شهر ری</div>
                        <div class="detail"><span><i class="fa fa-2x fa-star" aria-hidden="true"></i></span>هنر / معماری / باستانشناسی</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'content/template/static_register.html' %}
{%endblock%}

{%block foot_js%}
<script>
$(".answer-link").click(function(){
    $(this).ajaxify({
        ajax: {
            data: {
                'poll_id': $(this).attr("data-id"),
                'answer_key': $(this).attr("data-key"),
                'answer_text': $(this).attr("data-text")
            },
            method: 'post'
        }
    });
}).on("ajaxify:success", function(_xhr, _data){
    next_url = _data.msg.callback;

        $("<a href='{{base.url}}/" + next_url + "' data-direct>سوال بعدی</a>").appendTo(".next-url");
        $("div.opt").fadeOut();
        console.log(_data.msg.callback);

});


function bookmark(_poll_id) {
    $.ajax({
        type: 'get',
        // url: '@/polls',
        data: {
            'type' : 'bookmark',
            'poll_id': _poll_id
        },
        success: function(data) {
           // console.log(data);
        }
    });
}
$('.poll-chart').highcharts(load_chart('result'));

$(".results-box a").click(function(){
    type = $(this).attr("chart-type");
    $(".results-box a").each(function(){
        $(this).removeClass("active");
    });
    $(this).addClass("active");
    $('.poll-chart').highcharts(load_chart(type));
});

function load_chart(_type)
{
    if(_type == 'result')
    {
        var result = {
            chart: {type: 'column', backgroundColor: 'rgba(255, 255, 255, 0)'
                // events: {
                //     load: function() {
                //         var check = $('.top-chart').highcharts();
                //         check.yAxis[0].setExtremes(null, check.axes[1].dataMax);
                //     }
                // }
            },
            exporting: {enabled: false},
            credits: {enabled: false},
            title : "",xAxis: { labels: { enabled: false }, categories: ['']},
            yAxis: {min: 0,title: {text: 'درصد',enabled: false},labels: {enabled: false},gridLineWidth: 0,minorGridLineWidth: 0,},
            legend: {enabled: false },
            tooltip: {
                headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' + '<td style="padding:0"><b>{point.y:.1f} %</b></td></tr>',
                footerFormat: '</table>',
                shared: false,
                useHTML: true
            }, plotOptions: {column: {pointPadding: 0.2, borderWidth: 0}},
            series: eval({{chart.result.data| raw }})
        };
        return result;
    }
    data_chart =  {{chart|json_encode(constant("JSON_UNESCAPED_UNICODE"))|raw}};

     data = {chart: {type: 'column'},
        title: {text: data_chart[_type].title},
        xAxis: {categories: eval(data_chart[_type].categories) },
        yAxis: {min: 0,title: {text: 'مجموع رای دهنگان'},
            stackLabels: {enabled: true,style: {fontWeight: 'bold',
                    color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
                }
            }
        },
        legend: {align: 'right',x: -30,verticalAlign: 'top',y: 25, floating: true,
            backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || 'white',
            borderColor: '#CCC',
            borderWidth: 1,
            shadow: false
        },
        tooltip: {
            headerFormat: '<b>{point.x}</b><br/>',
            pointFormat: '{series.name}: {point.y}<br/>Total: {point.stackTotal}'
        },
        plotOptions: {
            column: {
                stacking: 'normal',
                dataLabels: {
                    enabled: true,
                    color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white'
                }
            }
        },
        series: eval(data_chart[_type].series)
    };

    return data;

}

$(function() {

    // $('.poll-chart').highcharts(x);
    $(".comments .comment .continue").click(function() {
        $(this).parents('.comment').children('.content').addClass('absolute-content');
        event.preventDefault();
            event.stopPropagation();
        $(".absolute-content").click(function(event){
            event.preventDefault();
            event.stopPropagation();
        });
    });
    $('body').click(function(event) {
        $(".content.absolute-content").removeClass("absolute-content");
    });
});
</script>
{%endblock%}
